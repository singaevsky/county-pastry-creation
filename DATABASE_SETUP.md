# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Supabase

## üìã –≠—Ç–∞–ø 1: –°–∏—Å—Ç–µ–º–∞ –∑–∞–∫–∞–∑–æ–≤ –∏ –ø–ª–∞—Ç–µ–∂–µ–π (–¢–ï–ö–£–©–ò–ô –≠–¢–ê–ü)

### –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ:

#### 1. **settings** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- `prepaid_percent`: –ø—Ä–æ—Ü–µ–Ω—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50%)
- –†–∞—Å—à–∏—Ä—è–µ–º–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### 2. **orders** - –ó–∞–∫–∞–∑—ã
- **–°—Ç–∞—Ç—É—Å-–º–∞—à–∏–Ω–∞**: `draft` ‚Üí `awaiting_payment` ‚Üí `paid` ‚Üí `cooking` ‚Üí `delivery` ‚Üí `done`/`cancelled`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á—ë—Ç –ø—Ä–µ–¥–æ–ø–ª–∞—Ç—ã (50%)
- –ü–æ–ª—è –¥–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏: –∞–¥—Ä–µ—Å, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, —Å—Ç–æ–∏–º–æ—Å—Ç—å
- –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–¥–∏—Ç–µ—Ä–∞: `assigned_cook_id`

#### 3. **payments** - –ü–ª–∞—Ç–µ–∂–∏
- –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã: –ÆKassa, Tinkoff (–≥–æ—Ç–æ–≤–æ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é)
- –°—Ç–∞—Ç—É—Å—ã: pending, completed, failed, refunded, partially_refunded
- –°—Å—ã–ª–∫–∏ –Ω–∞ –æ–ø–ª–∞—Ç—É –∏ —á–µ–∫–∏
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ JSONB

#### 4. **audit_logs** - –ê—É–¥–∏—Ç-–ª–æ–≥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–æ–≤
- –•—Ä–∞–Ω–µ–Ω–∏–µ old_data –∏ new_data –≤ JSONB
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ user_id, ip_address, user_agent

#### 5. **order_status_transitions** - –ò—Å—Ç–æ—Ä–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–ø–∏—Å—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
- from_status ‚Üí to_status
- –ü–æ–ª–µ –¥–ª—è –∑–∞–º–µ—Ç–æ–∫

### üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (RLS)

–í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞—â–∏—â–µ–Ω—ã Row Level Security:
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–∫–∞–∑—ã
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∑–∞–∫–∞–∑–æ–≤ –≤ —Å—Ç–∞—Ç—É—Å–µ `draft`
- ‚úÖ –ü–ª–∞—Ç–µ–∂–∏ –≤–∏–¥–Ω—ã —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ –ê—É–¥–∏—Ç-–ª–æ–≥ –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–≤–æ–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π

### ‚öôÔ∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è

#### –¢—Ä–∏–≥–≥–µ—Ä—ã:
- **–ê—É–¥–∏—Ç**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ª–æ–≥–∏—Ä—É–µ—Ç INSERT/UPDATE/DELETE –≤ orders
- **–°—Ç–∞—Ç—É—Å-–ø–µ—Ä–µ—Ö–æ–¥—ã**: –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- **–ü—Ä–µ–¥–æ–ø–ª–∞—Ç–∞**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç prepaid_amount
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –∑–∞–ø—Ä–µ—â–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤

#### –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤:
```
draft ‚Üí –ª—é–±–æ–π —Å—Ç–∞—Ç—É—Å
awaiting_payment ‚Üí paid, cancelled
paid ‚Üí cooking, cancelled
cooking ‚Üí delivery, cancelled
delivery ‚Üí done, cancelled
```

### üìä –ò–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–°–æ–∑–¥–∞–Ω—ã –∏–Ω–¥–µ–∫—Å—ã –Ω–∞:
- `orders`: user_id, status, assigned_cook_id
- `payments`: order_id, status
- `audit_logs`: (table_name, record_id), user_id
- `order_status_transitions`: order_id

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ SQL –º–∏–≥—Ä–∞—Ü–∏—é

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª: **`database/orders_system.sql`**
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Supabase Dashboard ‚Üí SQL Editor
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å SQL –∫–æ–¥ –∏–∑ —Ñ–∞–π–ª–∞
4. –ù–∞–∂–º–∏—Ç–µ **"Run"**

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–í —Ä–∞–∑–¥–µ–ª–µ **Table Editor** –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã:
- ‚úÖ settings
- ‚úÖ orders  
- ‚úÖ payments
- ‚úÖ audit_logs
- ‚úÖ order_status_transitions

---

## üìù –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã

### newsletter_subscribers
–ü–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏

### products
–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–æ–≤

### contact_submissions
–°–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –∫–æ–Ω—Ç–∞–∫—Ç–Ω–æ–π —Ñ–æ—Ä–º—ã

### cart_items
–ö–æ—Ä–∑–∏–Ω–∞ –ø–æ–∫—É–ø–æ–∫ (–¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

### cake_configurations
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ—Ä—Ç–æ–≤ –Ω–∞ –∑–∞–∫–∞–∑ (—Å–≤—è–∑–∞–Ω–∞ —Å –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π orders)

---

## üîÆ –°–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≠—Ç–∞–ø–∞ 1:

### –≠—Ç–∞–ø 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π
- Edge Function –¥–ª—è –ÆKassa
- Edge Function –¥–ª—è Tinkoff
- Webhook –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
- –§–∏—Å–∫–∞–ª–∏–∑–∞—Ü–∏—è –∏ —á–µ–∫–∏

### –≠—Ç–∞–ø 3: –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è
- PostGIS —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
- –¢–∞–±–ª–∏—Ü–∞ cook_zones
- –ê–≤—Ç–æ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–æ–Ω–¥–∏—Ç–µ—Ä–∞
- WebSocket –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 4: –î–æ—Å—Ç–∞–≤–∫–∞
- –°–î–≠–ö API
- –Ø–Ω–¥–µ–∫—Å.–î–æ—Å—Ç–∞–≤–∫–∞ API
- –†–∞—Å—á—ë—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- Telegram –±–æ—Ç –¥–ª—è –∫–æ–Ω–¥–∏—Ç–µ—Ä–æ–≤

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- –í—Å–µ user_id –∫–æ–ª–æ–Ω–∫–∏ NOT NULL –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –í—Å–µ timestamps –≤ UTC
- –°—Ç–∞—Ç—É—Å-–ø–µ—Ä–µ—Ö–æ–¥—ã –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –ê—É–¥–∏—Ç-–ª–æ–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –î–ª—è –∞–¥–º–∏–Ω-–¥–æ—Å—Ç—É–ø–∞ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É user_roles (–≠—Ç–∞–ø 2)
